#!/bin/zsh

function ago() {
    [ -f go.mod ] || [ -f go.work ] && {
        TORUN=${1:-go run -tags=debug .}
        # TODO migrate to modd
        reflex -r '\.go$' -s -- sh -c "$TORUN 2>&1"
        return
    }

    [ -f Cargo.toml ] && {
      if [[ -z "${@// }" ]];then
        RUST_BACKTRACE="${RUST_BACKTRACE:-0}" cargo-watch -q -c -w src/ -x check -x "run -q"
      else 
        RUNCMD="run -q $@"
        RUST_BACKTRACE="${RUST_BACKTRACE:-0}" cargo-watch -q -c -w . -x check -x "$RUNCMD"
        return
      fi
    }

    [ -f pnpm-lock.yaml ] && {
        pnpm run dev --host
        return
    }

    [ -d .chalice ] && {
      # TODO migrate to modd
      reflex -r '\.py$' -s -- sh -c "chalice local"
      return
    }

    echo "Ecosystem not supported"
}
